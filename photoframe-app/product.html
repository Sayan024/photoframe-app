<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mx.banerjee | Product</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts - Inter & Playfair Display -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #21130d; /* Eternity - dark black/brown */
            --primary-color-hover: #e28743; /* Burnt Sienna */
            --text-color-dark: #21130d;
            --text-color-light: #6b7280;
            --bg-color-light: #eeeee4; /* Green White */
            --bg-color-white: #ffffff;
            --border-color: #d1d5db;
            --shadow-light: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-card: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4-px 6px -2px rgba(0, 0, 0, 0.05);
            --price-color: #5CB338;
            --accent-color: #eab676; /* Tacao */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-color-light);
            color: var(--text-color-dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Utility Classes --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        .text-center { text-align: center; }
        .card {
            background-color: var(--bg-color-white);
            border-radius: 1rem;
            box-shadow: var(--shadow-card);
            overflow: hidden;
        }
        .hidden { display: none; }
        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .flex-wrap {
            flex-wrap: wrap;
        }
        .gap-1 { gap: 1rem; }
        .gap-2 { gap: 2rem; }

        /* --- Header & Navigation --- */
        .header {
            background-color: var(--bg-color-white);
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 1rem 0;
        }
        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .logo:hover { color: var(--accent-color); }
        .nav-links {
            display: flex;
            gap: 1.5rem;
        }
        .nav-link {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color-light);
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.3s ease, transform 0.3s ease;
            position: relative;
            padding-bottom: 0.5rem;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: width 0.3s ease, left 0.3s ease;
        }
        .nav-link.active,
        .nav-link:hover { color: var(--primary-color); }
        .nav-link.active::after {
            width: 100%;
            left: 0;
        }
        .cart-link {
            position: relative;
        }
        .cart-icon-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .cart-badge {
            position: absolute;
            top: -0.25rem;
            right: -0.5rem;
            background-color: var(--primary-color);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 9999px;
            border: 1px solid white;
        }

        /* --- Main Content & Pages --- */
        .main {
            flex-grow: 1;
            padding: 2rem 0;
        }
        
        /* Product Detail page */
        .product-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            align-items: start;
            animation: fadeIn 0.5s ease-out;
            padding: 2rem;
            background-color: var(--bg-color-white);
            border-radius: 1rem;
            box-shadow: var(--shadow-card);
        }
        @media (min-width: 768px) {
            .product-container {
                grid-template-columns: 2fr 3fr 1.5fr;
            }
        }
        .image-gallery {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .main-image-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            padding-bottom: 100%; /* 1:1 Aspect Ratio */
            overflow: hidden;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }
        .main-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
            cursor: zoom-in;
        }
        .thumbnails {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .thumbnails img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            cursor: pointer;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
        }
        .thumbnails img.active {
            border-color: var(--primary-color);
        }
        .product-details {
            display: flex;
            flex-direction: column;
        }
        .product-details h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }
        .product-details .price-section {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .product-details .old-price {
            text-decoration: line-through;
            color: var(--text-color-light);
        }
        .product-details .new-price {
            color: var(--price-color);
            font-size: 2rem;
            font-weight: 800;
        }
        .product-details .discount {
            color: var(--primary-color);
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            background-color: var(--accent-color);
            border-radius: 9999px;
        }
        .product-details .highlights {
            list-style: none;
            padding-left: 0;
            margin: 1rem 0;
        }
        .product-details .highlights li {
            margin-bottom: 0.5rem;
            color: var(--text-color-dark);
        }
        .product-details .highlights li::before {
            content: '\2713'; /* Checkmark icon */
            color: var(--price-color);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }
        .buy-box {
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: var(--shadow-light);
            padding: 1rem;
            position: sticky;
            top: 2rem;
            align-self: flex-start;
            background-color: var(--bg-color-white);
        }
        .delivery {
            margin-bottom: 1rem;
            font-weight: 600;
        }
        .delivery input {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin-top: 0.5rem;
        }
        .buy-now-btn {
            background: var(--accent-color);
            color: var(--text-color-dark);
            border: none;
            padding: 0.8rem;
            width: 100%;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 25px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .buy-now-btn:hover {
            background: var(--primary-color-hover);
            transform: translateY(-2px);
        }
        .add-to-cart-btn {
            background: var(--primary-color);
            color: #fff;
            border: none;
            padding: 0.8rem;
            width: 100%;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .add-to-cart-btn:hover {
            background: #442e26;
            transform: translateY(-2px);
        }
        .sold-by {
            text-align: center;
            margin-top: 1rem;
            color: var(--text-color-light);
            font-size: 0.9rem;
        }

        .reviews-section {
            background-color: var(--bg-color-white);
            border-radius: 1rem;
            box-shadow: var(--shadow-card);
            padding: 2rem;
            margin-top: 2rem;
        }

        .review-card {
            background: var(--bg-color-white);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .review-card:last-child { border-bottom: none; }
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .reviewer-name { font-weight: 600; }
        .star-rating { color: #ffc107; }
        .review-text { color: var(--text-color-light); }
        
        .add-review-section {
            padding: 2rem;
            animation: fadeIn 0.5s ease-out;
        }
        .add-review-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }
        .add-review-form .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }
        .add-review-form label {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .add-review-form input, .add-review-form textarea {
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
        }
        .add-review-form textarea { resize: vertical; }
        .add-review-form .star-rating-input {
            display: flex;
            gap: 0.25rem;
            margin-top: 0.5rem;
            color: var(--text-color-light);
        }
        .add-review-form .star-rating-input .fa-star {
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .add-review-form .star-rating-input .fa-star.filled {
            color: #ffc107;
        }
        /* Mobile-first approach for review section */
        @media (max-width: 768px) {
            .reviews-section {
                margin-top: 1rem;
            }
        }
        /* Footer */
        .footer {
            background-color: var(--text-color-dark);
            color: var(--bg-color-white);
            padding: 2rem 0;
            margin-top: auto;
            text-align: center;
        }
        .footer .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        .footer-logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-color);
            text-decoration: none;
        }
        .footer-text {
            font-size: 0.875rem;
            color: var(--text-color-light);
        }
        
        /* --- Toast Notification (Centralized Modal) --- */
        .toast-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.1);
            display: none; /* Hidden by default */
            place-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease-out;
        }
        .toast-overlay.active { display: grid; }
        .toast {
            background-color: var(--bg-color-white);
            box-shadow: var(--shadow-card);
            padding: 1.5rem 2rem;
            border-radius: 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            max-width: 400px;
            width: 90%;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .toast .icon { font-size: 1.5rem; }
        .toast.success .icon { color: #5CB338; }
        .toast.error .icon { color: #FB4141; }
        .toast .message {
            font-weight: 600;
            font-size: 1rem;
            flex-grow: 1;
        }
        .toast-close-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-color-light);
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .toast-close-btn:hover { color: var(--text-color-dark); }
        
        /* --- Animations --- */
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="index.html" class="logo">mx.banerjee</a>
                <div class="nav-links">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i> <span>Home</span>
                    </a>
                    <a href="index.html" class="nav-link active">
                        <i class="fas fa-box"></i> <span>Products</span>
                    </a>
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-shopping-cart"></i> <span>Cart</span>
                    </a>
                    <a href="profile.html" class="nav-link">
                        <i class="fas fa-user"></i> <span id="user-nav-name">Profile</span>
                    </a>
                    <a href="admin-login.html" class="nav-link">
                        <i class="fas fa-lock"></i> <span>Admin</span>
                    </a>
                </div>
            </nav>
        </div>
    </header>

    <main class="main container">
        <div id="product-detail-content">
            <!-- Product details will be injected here by JS -->
        </div>
        <section id="add-review-section" class="add-review-section card">
            <h3>Add a Review</h3>
            <form id="add-review-form" class="add-review-form">
                <div class="form-group">
                    <label for="review-name">Your Name</label>
                    <input type="text" id="review-name" required>
                </div>
                <div class="form-group">
                    <label for="review-rating">Rating</label>
                    <div class="star-rating-input" id="review-rating-input">
                        <i class="fas fa-star" data-rating="1"></i>
                        <i class="fas fa-star" data-rating="2"></i>
                        <i class="fas fa-star" data-rating="3"></i>
                        <i class="fas fa-star" data-rating="4"></i>
                        <i class="fas fa-star" data-rating="5"></i>
                    </div>
                    <input type="hidden" id="review-rating" value="0" required>
                </div>
                <div class="form-group">
                    <label for="review-text">Your Review</label>
                    <textarea id="review-text" rows="4" required></textarea>
                </div>
                <button type="submit" class="add-to-cart-btn"><i class="fas fa-comment"></i> Submit Review</button>
            </form>
        </section>
    </main>
    
    <footer class="footer">
        <div class="container">
            <a href="index.html" class="footer-logo">mx.banerjee</a>
            <p class="footer-text">© 2023 mx.banerjee. All rights reserved.</p>
        </div>
    </footer>

    <!-- Toast Notification Overlay -->
    <div id="toast-overlay" class="toast-overlay">
        <div id="toast" class="toast card">
            <i id="toast-icon" class="fas icon"></i>
            <span id="toast-message" class="message"></span>
            <button id="toast-close-btn" class="toast-close-btn"><i class="fas fa-times"></i></button>
        </div>
    </div>
    
    <script>
        // --- Data Persistence Functions using localStorage ---
        function saveData() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('cart', JSON.stringify(cart));
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            localStorage.setItem('orders', JSON.stringify(orders));
        }

        function loadData() {
            const storedProducts = localStorage.getItem('products');
            const storedCart = localStorage.getItem('cart');
            const storedProfile = localStorage.getItem('userProfile');
            const storedOrders = localStorage.getItem('orders');
            
            if (storedProducts) { products = JSON.parse(storedProducts); } else { products = []; }
            if (storedCart) { cart = JSON.parse(storedCart); } else { cart = []; }
            if (storedProfile) { userProfile = JSON.parse(storedProfile); } else {
                userProfile = {
                    name: 'Guest User',
                    address1: '',
                    address2: '',
                    city: '',
                    state: '',
                    pincode: '',
                    country: '',
                    age: '',
                    phone: ''
                };
            }
            if (storedOrders) { orders = JSON.parse(storedOrders); } else { orders = []; }
        }
        
        // Initial set of products to be used on a reset
        const initialProducts = [
            {
                id: 1,
                name: 'Traditional Engraved Frame',
                price: 1899.00,
                oldPrice: 2000.00,
                discount: '5%',
                category: 'Wooden Frames',
                image: 'https://placehold.co/400x400/CCCCCC/333333?text=Product+1A',
                images: [
                    'https://placehold.co/400x400/CCCCCC/333333?text=Product+1A',
                    'https://placehold.co/400x400/FFC145/FFFFFF?text=Product+1B',
                    'https://placehold.co/400x400/333333/FFFFFF?text=Product+1C',
                ],
                description: `Bring Your Walls to Life with Premium Posters!

Our high-quality posters are digitally created and printed on Kodak 180 GSM paper, delivering vibrant colors, crisp details, and a professional finish that lasts. Perfect for room décor, gifting, or adding personality to your space.
We offer exclusive deals like Buy 6 Posters and Get 2 Free – giving you 8 stunning prints for just ₹300! From art and quotes to photography and custom designs, you’ll find the perfect piece to match your style.
Order today and enjoy premium quality at an unbeatable price. Contact us for more details or custom requests!`,
                highlights: [
                    'High-quality wooden frame',
                    'Customizable with 9 photos',
                    'Elegant finish'
                ],
                reviews: [
                    { name: 'Rahul S.', rating: 5, text: 'Beautiful craftsmanship and fast delivery!' },
                    { name: 'Priya K.', rating: 4, text: 'Solid frame, looks great. A bit smaller than expected.' }
                ]
            },
            {
                id: 2,
                name: 'Elegant Zari Work Frame',
                price: 3500.50,
                oldPrice: 4000.00,
                discount: '12%',
                category: 'Metallic Frames',
                image: 'https://placehold.co/400x400/CCCCCC/333333?text=Product+2A',
                images: [
                    'https://placehold.co/400x400/CCCCCC/333333?text=Product+2A',
                    'https://placehold.co/400x400/FFC145/FFFFFF?text=Product+2B',
                    'https://placehold.co/400x400/333333/FFFFFF?text=Product+2C',
                ],
                description: `Bring Your Walls to Life with Premium Posters!

Our high-quality posters are digitally created and printed on Kodak 180 GSM paper, delivering vibrant colors, crisp details, and a professional finish that lasts. Perfect for room décor, gifting, or adding personality to your space.
We offer exclusive deals like Buy 6 Posters and Get 2 Free – giving you 8 stunning prints for just ₹300! From art and quotes to photography and custom designs, you’ll find the perfect piece to match your style.
Order today and enjoy premium quality at an unbeatable price. Contact us for more details or custom requests!`,
                highlights: [
                    'Ornate frame with a touch of gold leaf',
                    'Perfect for wedding photos',
                    'Durable metal construction'
                ],
                reviews: [
                    { name: 'Anjali V.', rating: 5, text: 'Absolutely stunning! Exceeded my expectations.' },
                    { name: 'Vijay P.', rating: 5, text: 'Perfect for my wedding photo. The detail is incredible.' }
                ]
            },
            {
                id: 3,
                name: 'Rustic Terracotta Frame',
                price: 2450.00,
                oldPrice: 2800.00,
                discount: '12.5%',
                category: 'Collage Frames',
                image: 'https://placehold.co/400x400/CCCCCC/333333?text=Product+3A',
                images: [
                    'https://placehold.co/400x400/CCCCCC/333333?text=Product+3A',
                    'https://placehold.co/400x400/FFC145/FFFFFF?text=Product+3B',
                    'https://placehold.co/400x400/333333/FFFFFF?text=Product+3C',
                ],
                description: `Bring Your Walls to Life with Premium Posters!

Our high-quality posters are digitally created and printed on Kodak 180 GSM paper, delivering vibrant colors, crisp details, and a professional finish that lasts. Perfect for room décor, gifting, or adding personality to your space.
We offer exclusive deals like Buy 6 Posters and Get 2 Free – giving you 8 stunning prints for just ₹300! From art and quotes to photography and custom designs, you’ll find the perfect piece to match your style.
Order today and enjoy premium quality at an unbeatable price. Contact us for more details or custom requests!`,
                highlights: [
                    'Hand-carved terracotta design',
                    'Rustic, natural feel',
                    'Holds multiple photos'
                ],
                reviews: [
                    { name: 'Karan D.', rating: 4, text: 'Great unique design. The color is a bit different from the picture.' }
                ]
            },
            {
                id: 4,
                name: 'Minimalist Metallic Frame',
                price: 2999.00,
                oldPrice: 3500.00,
                discount: '14%',
                category: 'Custom Designs',
                image: 'https://placehold.co/400x400/CCCCCC/333333?text=Product+4A',
                images: [
                    'https://placehold.co/400x400/CCCCCC/333333?text=Product+4A',
                    'https://placehold.co/400x400/FFC145/FFFFFF?text=Product+4B',
                    'https://placehold.co/400x400/333333/FFFFFF?text=Product+4C',
                ],
                description: `Bring Your Walls to Life with Premium Posters!

Our high-quality posters are digitally created and printed on Kodak 180 GSM paper, delivering vibrant colors, crisp details, and a professional finish that lasts. Perfect for room décor, gifting, or adding personality to your space.
We offer exclusive deals like Buy 6 Posters and Get 2 Free – giving you 8 stunning prints for just ₹300! From art and quotes to photography and custom designs, you’ll find the perfect piece to match your style.
Order today and enjoy premium quality at an unbeatable price. Contact us for more details or custom requests!`,
                highlights: [
                    'A shimmering metallic frame',
                    'Adds a touch of sophistication',
                    'Customizable size and color'
                ],
                reviews: []
            },
        ];

        let products;
        let cart;
        let userProfile;
        let orders;
        
        loadData();
        if (products.length === 0) {
            products = [...initialProducts];
        }


        const productDetailContent = document.getElementById('product-detail-content');
        const addReviewForm = document.getElementById('add-review-form');
        const reviewRatingInput = document.getElementById('review-rating-input');
        const toastOverlay = document.getElementById('toast-overlay');
        const toastMessageElement = document.getElementById('toast-message');
        const toastIconElement = document.getElementById('toast-icon');
        const toastCloseBtn = document.getElementById('toast-close-btn');
        const toast = document.getElementById('toast');
        let toastTimeout;
        let currentProduct;

        // --- Product Detail Page Logic ---
        function renderProductDetailPage() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = parseInt(urlParams.get('id'));
            currentProduct = products.find(p => p.id === productId);
            
            if (!currentProduct) {
                productDetailContent.innerHTML = `<div class="card" style="text-align:center; padding: 4rem;">Product not found.</div>`;
                return;
            }

            const starRating = (rating) => {
                let stars = '';
                for (let i = 0; i < 5; i++) {
                    stars += `<i class="fas fa-star ${i < rating ? 'star-rating' : ''}"></i>`;
                }
                return stars;
            }
            
            const averageRating = currentProduct.reviews.length > 0
                ? (currentProduct.reviews.reduce((sum, review) => sum + review.rating, 0) / currentProduct.reviews.length).toFixed(1)
                : 'N/A';
            const totalReviews = currentProduct.reviews.length;
            
            productDetailContent.innerHTML = `
                <div class="product-container">
                    <!-- Left Column: Image Gallery -->
                    <div class="image-gallery">
                        <div class="main-image-container">
                            <img id="main-product-image" src="${currentProduct.image}" alt="${currentProduct.name}" class="main-image">
                        </div>
                        <div class="thumbnails">
                            ${currentProduct.images.filter(img => img).map((img, index) => `
                                <img src="${img}" alt="${currentProduct.name} thumbnail ${index + 1}" class="thumbnail ${index === 0 ? 'active' : ''}" data-image="${img}">
                            `).join('')}
                        </div>
                    </div>

                    <!-- Middle Column: Product Details -->
                    <div class="product-details">
                        <h1>${currentProduct.name}</h1>
                        <div class="rating-section" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                            <span class="star-rating">${starRating(Math.round(averageRating))}</span>
                            <span style="font-weight: 600; color: var(--text-color-dark);">${averageRating}</span>
                            <span style="color: var(--text-color-light); font-size: 0.875rem;">(${totalReviews} reviews)</span>
                        </div>
                        <p class="description">${currentProduct.description}</p>
                        <ul class="highlights">
                            ${currentProduct.highlights.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>

                    <!-- Right Column: Buy Box -->
                    <div class="buy-box">
                        <div class="price-section">
                            <span class="new-price">₹${currentProduct.price.toFixed(2)}</span>
                            ${currentProduct.oldPrice ? `<span class="old-price">₹${currentProduct.oldPrice.toFixed(2)}</span>` : ''}
                            ${currentProduct.discount ? `<span class="discount">${currentProduct.discount} off</span>` : ''}
                        </div>
                        <div class="delivery">
                            Deliver to:
                            <input type="text" placeholder="Enter Pincode">
                        </div>
                        <button class="buy-now-btn">Buy Now</button>
                        <button class="add-to-cart-btn" onclick="addToCart(${currentProduct.id})">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                        <p class="sold-by">Sold by mx.banerjee</p>
                    </div>
                </div>
                <!-- Additional review sections below the main grid -->
                <div class="reviews-section card">
                    <h3>Customer Reviews</h3>
                    <div id="reviews-list">
                        ${currentProduct.reviews.length > 0 ? currentProduct.reviews.map(review => `
                            <div class="review-card">
                                <div class="review-header">
                                    <span class="reviewer-name">${review.name}</span>
                                    <span class="star-rating">${starRating(review.rating)}</span>
                                </div>
                                <p class="review-text">${review.text}</p>
                            </div>
                        `).join('') : '<p>No reviews yet. Be the first to review this product!</p>'}
                    </div>
                </div>
            `;

            attachEventListeners();
        }

        function changeMainImage(newSrc) {
            document.getElementById('main-product-image').src = newSrc;
        }
        
        function attachEventListeners() {
            const thumbnails = document.querySelectorAll('.thumbnails img');
            const mainImage = document.getElementById('main-product-image');

            thumbnails.forEach(thumbnail => {
                thumbnail.addEventListener('click', (e) => {
                    const newSrc = e.target.getAttribute('data-image');
                    changeMainImage(newSrc);
                    thumbnails.forEach(thumb => thumb.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });

            // Zoom effect on main image
            mainImage.addEventListener('mousemove', function(e) {
                const zoom = 1.5; // zoom level
                const rect = e.target.getBoundingClientRect();
                const offsetX = e.clientX - rect.left;
                const offsetY = e.clientY - rect.top;
                const percentX = (offsetX / rect.width) * 100;
                const percentY = (offsetY / rect.height) * 100;

                mainImage.style.transformOrigin = `${percentX}% ${percentY}%`;
                mainImage.style.transform = `scale(${zoom})`;
            });
            mainImage.addEventListener('mouseleave', function() {
                mainImage.style.transform = 'scale(1)';
            });
        }


        // --- Cart Logic (copied here for self-containment) ---
        function addToCart(productId) {
            loadData();
            const product = products.find(p => p.id === productId);
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            saveData();
            showToast(`${product.name} added to cart!`);
        }
        
        // --- Toast Notification ---
        function showToast(message, type = 'success') {
            clearTimeout(toastTimeout);
            toastMessageElement.textContent = message;
            toast.className = 'toast card ' + type;
            if (type === 'success') {
                toastIconElement.className = 'fas fa-check-circle icon';
            } else {
                toastIconElement.className = 'fas fa-exclamation-triangle icon';
            }
            toastOverlay.classList.add('active');
            toastTimeout = setTimeout(() => {
                toastOverlay.classList.remove('active');
            }, 3000);
        }
        toastCloseBtn.addEventListener('click', () => {
            toastOverlay.classList.remove('active');
            clearTimeout(toastTimeout);
        });
        
        // --- User Name in Nav Bar ---
        function updateNavProfile() {
            const userNavNameSpan = document.getElementById('user-nav-name');
            if (userNavNameSpan && userProfile && userProfile.name && userProfile.name !== 'Guest User') {
                userNavNameSpan.textContent = `Hello, ${userProfile.name.split(' ')[0]}!`;
            }
        }

        // --- New Review Logic ---
        let selectedRating = 0;
        
        document.addEventListener('click', (e) => {
            if (e.target.closest('#review-rating-input')) {
                const star = e.target.closest('.fa-star');
                if (star) {
                    selectedRating = parseInt(star.dataset.rating);
                    document.getElementById('review-rating').value = selectedRating;
                    document.querySelectorAll('.star-rating-input .fa-star').forEach(s => s.classList.remove('filled'));
                    for (let i = 1; i <= selectedRating; i++) {
                        document.querySelector(`.star-rating-input .fa-star[data-rating="${i}"]`).classList.add('filled');
                    }
                }
            }
        });


        document.addEventListener('submit', (e) => {
             if (e.target.id === 'add-review-form') {
                e.preventDefault();
                const reviewerName = document.getElementById('review-name').value;
                const reviewText = document.getElementById('review-text').value;
                const reviewRating = parseInt(document.getElementById('review-rating').value);

                if (reviewRating === 0) {
                    showToast('Please provide a star rating.', 'error');
                    return;
                }

                const newReview = {
                    name: reviewerName,
                    rating: reviewRating,
                    text: reviewText
                };
                
                const productIndex = products.findIndex(p => p.id === currentProduct.id);
                if (productIndex !== -1) {
                    products[productIndex].reviews.push(newReview);
                    saveData();
                    renderProductDetailPage();
                    document.getElementById('add-review-form').reset();
                    selectedRating = 0;
                    document.querySelectorAll('.star-rating-input .fa-star').forEach(s => s.classList.remove('filled'));
                    showToast('Review submitted successfully!', 'success');
                }
             }
        });


        // Initial render on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderProductDetailPage();
            updateNavProfile();
        });
    </script>
</body>
</html>
